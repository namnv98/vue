<template>
  <div id="app">
    <HelloWorld
      v-for="(i, index) in sizeColumns"
      :key="index"
      :menus="menus"
      :count="i.index"
    />
  </div>
</template>

<script>
import HelloWorld from "./components/HelloWorld.vue";

export default {
  name: "App",
  components: {
    HelloWorld,
  },
  data() {
    return {
      listMenu: [
        {
          value: "Title 1",
          category: [
            {
              value: "Category 1",
              menu: [
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
              ],
            },
            {
              value: "Category 2",
              menu: [
                {
                  value: "Menu 2",
                },
                {
                  value: "Menu 2",
                },
              ],
            },
            {
              value: "Category 3",
              menu: [
                {
                  value: "Menu 3",
                },
                {
                  value: "Menu 3",
                },
              ],
            },

            {
              value: "Category 3",
              menu: [
                {
                  value: "Menu 1",
                },
                {
                  value: "Menu 1",
                },
              ],
            },
          ],
        },
        {
          value: "Title 2",
          category: [
            {
              value: "Category 1",
              menu: [
                {
                  value: "Menu 1",
                },
              ],
            },
          ],
        },
      ],
      menus: [],
      sizeColumns: [],
    };
  },
  created() {
    var splitColumns = [];
    var sizeOfTitle = [];
    var maxRow = 6;

    //convert tree to list
    for (var l = 0; l < this.listMenu.length; l++) {
      this.menus.push({ value: this.listMenu[l].value, type: "title" });
      var index = 1;
      for (var t = 0; t < this.listMenu[l].category.length; t++) {
        this.menus.push({
          value: this.listMenu[l].category[t].value,
          type: "category",
        });
        index++;
        for (var m = 0; m < this.listMenu[l].category[t].menu.length; m++) {
          this.menus.push({
            value: this.listMenu[l].category[t].menu[m].value,
            type: "menu",
          });
          index++;
        }
        sizeOfTitle.push({ index });
        index = 0;
      }
    }

    //tách dữ liệu nếu length > đk
    for (let i = 0; i < sizeOfTitle.length; i++) {
      var value = sizeOfTitle[i].index;
      if (value > maxRow) {
        while (value > maxRow) {
          splitColumns.push(maxRow);
          value = value - maxRow;
        }
        if (value <= maxRow) {
          splitColumns.push(value);
        }
      } else {
        splitColumns.push(value);
      }
    }

    //hợp nhất các cột nếu còn đủ chỗ trống
    for (var i = 0; i < splitColumns.length - 1; i++) {
      if (splitColumns[i] + splitColumns[i + 1] == maxRow) {
        let temp = splitColumns[i] + splitColumns[i + 1];
        this.sizeColumns.push({ index: temp });
      }

      if (splitColumns[i] + splitColumns[i + 1] > maxRow) {
        let temp = splitColumns[i];
        this.sizeColumns.push({ index: temp });

        if (i + 1 == splitColumns.length - 1) {
          let temp = splitColumns[i + 1];
          this.sizeColumns.push({ index: temp });
        }
      }

      if (splitColumns[i] + splitColumns[i + 1] < maxRow) {
        let temp = splitColumns[i] + splitColumns[i + 1];
        splitColumns[i + 1] = temp;
      }
    }
  },
};
</script>
